<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redirecting...</title>
</head>
<body>
    <script type="module">
        async function redirect() {
            try {
                // Get the current URL path
                const currentPath = window.location.pathname;
                console.log("Current Path:", currentPath);

                // Cloud Function URL (using relative path)
                const cloudFunctionUrl = `https://us-central1-around-the-ville.cloudfunctions.net/app`; // Use a relative URL for your Cloud Function

                // Call the Cloud Function to get the corresponding blog_number
                const response = await fetch(cloudFunctionUrl, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ path: currentPath }), // Pass the current path as JSON
                });

                if (!response.ok) {
                    throw new Error(`Cloud Function error: ${response.status} - ${response.statusText}`);
                }

                const { blogNumber } = await response.json(); // Parse the Cloud Function's response

                // Check if blogNumber exists and redirect
                if (blogNumber) {
                    console.log("Redirecting to blog:", blogNumber);
                    window.location.replace(`/blogs/${blogNumber}`); // Redirect to the blog using a relative path
                } else {
                    console.warn("No matching blog found. Redirecting to homepage.");
                    window.location.replace('/'); // Fallback redirect to homepage using a relative path
                }
            } catch (error) {
                console.error("Error calling Cloud Function:", error);
                window.location.replace('/'); // Fallback redirect on error using a relative path
            }
        }

        // Call the redirect function
        redirect();
    </script>
</body>
</html>
