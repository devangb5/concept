<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redirecting...</title>
</head>
<body>
    <script type="module">
        async function redirect() {
            try {
                // Get the current URL path and construct the full URL
                const currentPath = window.location.pathname;
                const fullUrl = `https://aroundtheville.com${currentPath}`;
                console.log("Current Path:", currentPath);
                console.log("Full URL Queried:", fullUrl);

                // Cloud Function URL
                const cloudFunctionUrl = `https://us-central1-around-the-ville.cloudfunctions.net/app-1`; // Replace with your actual Cloud Function URL

                // Call the Cloud Function to get the corresponding blog_numbe
                const response = await fetch(cloudFunctionUrl, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ url: fullUrl }), // Pass the current URL as JSON
                });

                if (!response.ok) {
                    throw new Error(`Cloud Function error: ${response.status} - ${response.statusText}`);
                }

                const { blogNumber } = await response.json(); // Parse the Cloud Function's response

                // Check if blogNumber exists and redirect
                if (blogNumber) {
                    console.log("Redirecting to blog:", blogNumber);
                    window.location.replace(`https://aroundtheville.com/blogs/${blogNumber}`);
                } else {
                    console.warn("No matching blog found. Redirecting to homepage.");
                    window.location.replace('https://aroundtheville.com/'); // Fallback redirect
                }
            } catch (error) {
                console.error("Error calling Cloud Function:", error);
                window.location.replace('https://aroundtheville.com/'); // Fallback redirect on error
            }
        }

        // Call the redirect function
        redirect();
    </script>
</body>
</html>
